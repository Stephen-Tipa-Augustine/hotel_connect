import 'package:firebase_storage/firebase_storage.dart';
import 'package:flutter/material.dart';

class FireStorageService extends ChangeNotifier {
  FireStorageService();

  static Future<dynamic> loadFromStorage(
      BuildContext context, String image) async {
    return await FirebaseStorage.instance.ref().child(image).getDownloadURL();
  }
}

class GetImageFromFirebase extends StatelessWidget {
  final String filePath;
  GetImageFromFirebase({this.filePath});

  Future<Widget> _getImage(BuildContext context, String image) async {
    Image m;
    try {
      await FireStorageService.loadFromStorage(context, image)
          .then((downloadUrl) {
        m = Image.network(
          downloadUrl.toString(),
          fit: BoxFit.scaleDown,
        );
      });
    } catch (e) {
      m = Image.asset('assets/images/no_image.jpg');
    }

    return m;
  }

  @override
  Widget build(BuildContext context) {
    return Container(
      child: FutureBuilder(
        future: _getImage(context, this.filePath),
        builder: (context, snapshot) {
          if (snapshot.connectionState == ConnectionState.done) {
            return snapshot.data;
          } else {
            return Container(child: CircularProgressIndicator());
          }
        },
      ),
    );
  }
}
